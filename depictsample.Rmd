---
title: "simple_DEPICT"
author: "Chen"
date: "2016年12月3日"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# GSEA STEP

## annotation matrix

```{r, eval=TRUE}
mtxg <- matrix(0,nrow=100,ncol=20)
mtxg[sample(1:2000,300)] <- 1 
image(mtxg)
colnames(mtxg)<-paste("gset",1:20,sep="_")

cs <- numeric(100)
cs[sample(1:100,20)] <- 1


f_zcs2gs <- function(cs,mtxg){
  apply(mtxg,2,function(x){
  x=factor(x,levels = c(0,1));
  y=factor(cs,levels = c(0,1));
  f <- fisher.test(table(cs,x))
  p <- f$p.value
  s <- ifelse(f$estimate>1,1,-1)
  s*qnorm(p/2,lower.tail = F)
  })
}

cs <- mtxg[,2]


zcs2gs <- f_zcs2gs(cs,mtxg)
f_zg2cs <- function(ga,zs2gs){
  a <- cor.test(zcs2gs,ga)
  p <- a$p.value
  s <- ifelse(a$estimate>1,1,-1)
  c(z=s*qnorm(p/2,lower.tail = F),p=p)
}

ga <- mtxg[which(cs==1)[1],]




x<-c(1,1,1,1,0,0,0,0)
y<-c(1,1,1,1,1,1,0,0)

cor.test(x,y)

fisher.test(table(x,y))

x


```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
